<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-key="chatPageTitle">Чат – J4Teen</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="topbar">
  <div class="logo">J4Teen</div>
  <button id="lang-toggle" type="button">EN</button>
  <div class="burger">☰</div>

  <div class="menu">
    <a href="index.html" data-key="home">Начало</a>
    <a href="jobs.html" data-key="jobs">Обяви</a>
    <a href="categories.html" data-key="categories">Категории</a>
    <a href="news.html" data-key="newsMenu">Новини</a>
    <a href="pricing.html" data-key="plans">Планове</a>
    <a href="post.html" data-key="post">Публикувай</a>
    <a href="chat.html" data-key="chat">Чат</a>
  </div>
</nav>

<header class="hero small">
  <div class="hero-content">
    <h1 data-key="chatTitle">Чат</h1>
    <p data-key="chatSubtitle">Свържи се директно</p>
  </div>
</header>

<main class="container">

  <!-- CHAT BOX -->
  <div id="chat-box" style="
    max-width:720px;
    margin:20px auto;
    padding:16px;
    background:#f8fafc;
    border-radius:20px;
    box-shadow:0 8px 24px rgba(0,0,0,0.08);
    min-height:280px;
    display:flex;
    flex-direction:column;
    gap:8px;
  "></div>

  <!-- CHAT FORM -->
  <form id="chat-form" style="
    max-width:720px;
    margin:12px auto 24px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  ">
    <input
      id="chat-name"
      data-key-placeholder="chatNamePh"
      placeholder="Име"
      required
      style="
        flex:1;
        min-width:140px;
        padding:12px;
        border-radius:999px;
        border:1px solid #d1d5db;
      "
    >

    <textarea
      id="chat-message"
      data-key-placeholder="chatMsgPh"
      placeholder="Съобщение"
      required
      rows="1"
      style="
        flex:3;
        min-width:220px;
        padding:12px 16px;
        border-radius:999px;
        border:1px solid #d1d5db;
        resize:none;
      "
    ></textarea>

    <button type="submit"
      data-key="chatSend"
      style="
        padding:12px 20px;
        border-radius:999px;
        background:#2563eb;
        color:white;
        font-weight:700;
        border:none;
        cursor:pointer;
        min-width:120px;
      ">
      Изпрати
    </button>
  </form>

</main>

<script src="main.js"></script>

<script>
  const params = new URLSearchParams(window.location.search);
  const jobId = params.get("jobId") || "global";

  const STORAGE_KEY = "chat_" + jobId;

  const chatBox = document.getElementById("chat-box");
  const chatForm = document.getElementById("chat-form");
  const nameInput = document.getElementById("chat-name");
  const messageInput = document.getElementById("chat-message");

  messageInput.focus();

  function renderChat() {
    const messages = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    chatBox.innerHTML = "";

    messages.forEach(msg => {
      const isMe = msg.name === nameInput.value;

      const bubble = document.createElement("div");
      bubble.style.alignSelf = isMe ? "flex-end" : "flex-start";
      bubble.style.maxWidth = "80%";
      bubble.style.background = isMe ? "#2563eb" : "#ffffff";
      bubble.style.color = isMe ? "#ffffff" : "#111111";
      bubble.style.padding = "12px 16px";
      bubble.style.borderRadius = "16px";
      bubble.style.boxShadow = "0 2px 8px rgba(0,0,0,0.06)";

      bubble.innerHTML = `
        <div style="font-weight:700; font-size:13px; opacity:0.85; margin-bottom:4px;">
          ${msg.name}
        </div>
        <div style="font-size:15px; white-space:pre-wrap;">
          ${msg.text}
        </div>
      `;

      chatBox.appendChild(bubble);
    });

    chatBox.scrollTop = chatBox.scrollHeight;
  }

  renderChat();

  messageInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      chatForm.requestSubmit();
    }
  });

  chatForm.addEventListener("submit", e => {
    e.preventDefault();

    const name = nameInput.value.trim();
    const text = messageInput.value.trim();
    if (!name || !text) return;

    const messages = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    messages.push({ name, text, createdAt: new Date().toISOString() });

    localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));

    messageInput.value = "";
    messageInput.focus();
    renderChat();
  });
</script>

</body>
</html>
