<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-key="chatPageTitle">–ß–∞—Ç ‚Äì J4Teen</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="topbar">
  <div class="logo">J4Teen</div>
  <button id="lang-toggle" type="button">EN</button>
  <div class="burger">‚ò∞</div>

  <div class="menu">
    <a href="index.html" data-key="home">–ù–∞—á–∞–ª–æ</a>
    <a href="jobs.html" data-key="jobs">–û–±—è–≤–∏</a>
    <a href="categories.html" data-key="categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
    <a href="news.html" data-key="newsMenu">–ù–æ–≤–∏–Ω–∏</a>
    <a href="pricing.html" data-key="plans">–ü–ª–∞–Ω–æ–≤–µ</a>
    <a href="post.html" data-key="post">–ü—É–±–ª–∏–∫—É–≤–∞–π</a>
    <a href="chat.html" data-key="chat">–ß–∞—Ç</a>
  </div>
</nav>

<header class="hero small">
  <div class="hero-content">
    <h1 data-key="chatTitle">–ß–∞—Ç</h1>
    <p data-key="chatSubtitle">–°–≤—ä—Ä–∂–∏ —Å–µ –¥–∏—Ä–µ–∫—Ç–Ω–æ</p>
  </div>
</header>

<main class="container">

  <!-- CHAT BOX -->
  <div id="chat-box" style="
    max-width:720px;
    margin:20px auto;
    padding:16px;
    background:#f8fafc;
    border-radius:20px;
    box-shadow:0 8px 24px rgba(0,0,0,0.08);
    min-height:280px;
    display:flex;
    flex-direction:column;
    gap:8px;
  "></div>

  <!-- CHAT FORM -->
  <form id="chat-form" style="
    max-width:720px;
    margin:12px auto 24px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  ">
    <!-- ‚ùå –ù–Ø–ú–ê input –∑–∞ –∏–º–µ -->

    <textarea
      id="chat-message"
      data-key-placeholder="chatMsgPh"
      placeholder="–°—ä–æ–±—â–µ–Ω–∏–µ"
      required
      rows="1"
      style="
        flex:1;
        min-width:220px;
        padding:12px 16px;
        border-radius:999px;
        border:1px solid #d1d5db;
        resize:none;
      "
    ></textarea>

    <button type="submit"
      data-key="chatSend"
      style="
        padding:12px 20px;
        border-radius:999px;
        background:#2563eb;
        color:white;
        font-weight:700;
        border:none;
        cursor:pointer;
        min-width:120px;
      ">
      –ò–∑–ø—Ä–∞—Ç–∏
    </button>
  </form>

</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="main.js"></script>

<script>
  const chatBox = document.getElementById("chat-box");
  const chatForm = document.getElementById("chat-form");
  const messageInput = document.getElementById("chat-message");

  const SUPABASE_URL = "https://aujswymolniwtdxyangf.supabase.co";
  const SUPABASE_KEY = "sb_publishable_UNykLLkp5Jzb9TQlq-qijg_U94miJxS";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  let currentUserEmail = "";

  // üîê CHECK LOGIN
  document.addEventListener("DOMContentLoaded", async () => {
    const { data } = await supabase.auth.getUser();
    if (!data.user) {
      window.location.href = "login.html";
      return;
    }
    currentUserEmail = data.user.email;
    renderChat();
  });

  function renderChat() {
    const messages = JSON.parse(localStorage.getItem("chat") || "[]");
    chatBox.innerHTML = "";

    messages.forEach(msg => {
      const isMe = msg.name === currentUserEmail;

      const bubble = document.createElement("div");
      bubble.style.alignSelf = isMe ? "flex-end" : "flex-start";
      bubble.style.maxWidth = "80%";
      bubble.style.background = isMe ? "#2563eb" : "#ffffff";
      bubble.style.color = isMe ? "#ffffff" : "#111111";
      bubble.style.padding = "12px 16px";
      bubble.style.borderRadius = "16px";
      bubble.style.boxShadow = "0 2px 8px rgba(0,0,0,0.06)";

      bubble.innerHTML = `
        <div style="font-weight:700; margin-bottom:4px; font-size:13px;">
          ${msg.name}
        </div>
        <div style="font-size:15px; white-space:pre-wrap;">
          ${msg.text}
        </div>
      `;

      chatBox.appendChild(bubble);
    });

    chatBox.scrollTop = chatBox.scrollHeight;
  }

  chatForm.addEventListener("submit", function(e) {
    e.preventDefault();

    const text = messageInput.value.trim();
    if (!text) return;

    const messages = JSON.parse(localStorage.getItem("chat") || "[]");
    messages.push({
      name: currentUserEmail,
      text
    });

    localStorage.setItem("chat", JSON.stringify(messages));
    messageInput.value = "";
    renderChat();
  });
</script>

</body>
</html>
