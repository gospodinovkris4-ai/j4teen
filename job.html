<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-key="jobPageTitle">Обява – J4Teen</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<nav class="topbar">
  <div class="logo">J4Teen</div>
  <button id="lang-toggle" type="button">EN</button>
  <div class="burger">☰</div>

  <div class="menu">
    <a href="index.html" data-key="home">Начало</a>
    <a href="jobs.html" data-key="jobs">Обяви</a>
    <a href="categories.html" data-key="categories">Категории</a>
    <a href="news.html" data-key="newsMenu">Новини</a>
    <a href="pricing.html" data-key="plans">Планове</a>
    <a href="post.html" data-key="post">Публикувай</a>
    <a href="chat.html" data-key="chat">Чат</a>
  </div>
</nav>

<header class="hero small">
  <div class="hero-content">
    <h1 id="job-title">Обява</h1>
    <p id="job-category"></p>
  </div>
</header>

<main class="container">

  <div class="job" style="max-width:700px; margin:0 auto;">
    <div style="margin-bottom:12px;">
      <strong data-key="jobDescLabel">Описание:</strong>
      <p id="job-desc"></p>
    </div>

    <div style="margin-bottom:12px;">
      <strong data-key="jobPriceLabel">Заплащане:</strong>
      <p id="job-price"></p>
    </div>

    <button
      class="btn primary"
      style="margin-top:16px;"
      id="chat-btn"
      data-key="jobChatBtn"
    >
      Пиши в чата
    </button>
  </div>

</main>

<script src="main.js"></script>

<script>
  const params = new URLSearchParams(window.location.search);
  const jobId = params.get("id");

  const jobs = JSON.parse(localStorage.getItem("jobs") || "[]");

  // намираме обявата
  const job = jobs.find(j => j.id === jobId);

  const lang = localStorage.getItem("lang") || "bg";

  const categoryLabels = {
    animals: { bg: "Грижа за животни", en: "Animal care" },
    dog: { bg: "Разходка на куче", en: "Dog walking" },
    home: { bg: "Домашна помощ", en: "Home help" },
    delivery: { bg: "Доставки", en: "Delivery" },
    agriculture: { bg: "Земеделие", en: "Agriculture" },
    physical: { bg: "Физическа работа", en: "Physical work" },
    food: { bg: "Заведения", en: "Food & hospitality" },
    care: { bg: "Грижа за хора", en: "People care" },
    hourly: { bg: "Почасова помощ", en: "Hourly help" }
  };

  // ако няма обява
  if (!job) {
    document.querySelector("main").innerHTML = `
      <p style="text-align:center;">
        ${lang === "bg" ? "Обявата не е намерена." : "Job not found."}
      </p>
    `;
  }
  // ако е маркирана като изтрита
  else if (job.status === "deleted") {
    document.querySelector("main").innerHTML = `
      <p style="text-align:center;">
        ${lang === "bg"
          ? "Тази обява вече не е активна."
          : "This job is no longer active."}
      </p>
    `;
  }
  else {
    // гарантираме backend-ready полета (НЕ чупи старите)
    job.status = job.status || "active";
    job.owner_id = job.owner_id || null;
    job.createdAt = job.createdAt || new Date().toISOString();

    document.getElementById("job-title").textContent = job.title;
    document.getElementById("job-desc").textContent = job.desc;
    document.getElementById("job-price").textContent =
      job.price || (lang === "bg" ? "По договаряне" : "Negotiable");

    const label =
      categoryLabels[job.category]
        ? categoryLabels[job.category][lang]
        : job.category;

    document.getElementById("job-category").textContent = label;

    document.getElementById("chat-btn").addEventListener("click", () => {
      window.location.href = "chat.html";
    });

    // записваме евентуалните нови полета (безопасно)
    localStorage.setItem("jobs", JSON.stringify(jobs));
  }
</script>

</body>
</html>
